<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <link rel = "stylesheet" href = "/styles/s.css">
    <link rel = "stylesheet" href = "/styles/session.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Menu</title>
</head>
<body>

    <header id = "header" class="d-flex flex-wrap justify-content-center py-3">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
        <i class="px-2 bi bi-rocket-takeoff-fill"></i>
        <p id = "dream-work" class="fs-4">DreamLock</p>
        </a>
        <i class="controlButton bi bi-gear-wide-connected"></i>
        <i id = "musicIcon" class="controlButton bi bi-music-note-beamed"></i>
    </header>

    <video autoplay muted loop plays-inline class = "backVideo">
        <source src = "images/sky2.mp4" type = "video/mp4">
    </video>

    <div id = "pops">
        <div class = "hideIt" id = "musicHider"></div>
        <div class = "hideIt" id = "musicControl">
            <iframe id = "music1" class = "hideIt" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DX4hpot8sYudB?utm_source=generator&theme=0" width="95%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            <iframe id = "music2" class = "hideIt" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DWZ8HCIPoGGKp?utm_source=generator&theme=0" width="95%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            <iframe id = "music3" class = "hideIt" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DWUZ5bk6qqDSy?utm_source=generator&theme=0" width="95%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            <iframe id = "music4" class = "hideIt" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DWWQRwui0ExPn?utm_source=generator&theme=0" width="95%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
        </div>
    </div>

    <script>
        
        $(document).ready(function(){
            var work_mode = document.getElementById('Tstyle').dataset.myVariable;
            if(work_mode == "Grind"){
                $("#work-section").css("background-image", "url('../images/black.png')");
                $(musicIcon).css({display: "none"});
                $("#timerPopup").css("background", "black");
            }

            $(musicIcon).click(function(){
                    $(musicControl).removeClass("hideIt");
                    $(musicHider).removeClass("hideIt");
                    $(music1).removeClass("hideIt");
                    $(music2).removeClass("hideIt");
                    $(music3).removeClass("hideIt");
                    $(music4).removeClass("hideIt");
                    $(musicControl).css({height: '85vh', width: '320px'});
                }
            );
        });

        $(document).ready(function(){
            $(musicHider).click(function(){
                $(musicControl).addClass("hideIt");
                $(musicHider).addClass("hideIt");
                $(music1).addClass("hideIt");
                $(music2).addClass("hideIt");
                $(music3).addClass("hideIt");
                $(music4).addClass("hideIt");
            });
        });

        $(document).ready(function(){
            $(listIcon).click(function(){
                $(listControl).removeClass("hideIt");
                $(listHider).removeClass("hideIt");
                $(listControl).css({height: '85vh', width: '320px'});
            });
        });

        $(document).ready(function(){
            $(listHider).click(function(){
                $(listControl).addClass("hideIt");
                $(listHider).addClass("hideIt");
            });
        });

    </script>

    <div id = "centered">
        <% if(style == "Pomodoro"){ %>
            <div id = "mode"></div>
        <% } %>
        <div id = "timerPopup" class = "playContainer popup">
            <p id = "timer"></p>
        </div>
    </div>


    <div id="Thours" data-my-variable="<%= Thours %>"></div>
    <div id="Tmins" data-my-variable="<%= mins %>"></div>
    <div id = "Tstyle" data-my-variable="<%= style %>"></div>

    <script>
        var timerHours = document.getElementById('Thours').dataset.myVariable;
        console.log("timerHours: " + timerHours);
        var timerMins = document.getElementById('Tmins').dataset.myVariable;
        console.log("timerMins: " + timerMins);
        console.log(timerHours * 60);
        console.log(timerHours * 60 + parseInt(timerMins)); 
        var x = (timerHours * 60) + parseInt(timerMins);
    
        function startTimer(duration, display, type, callback) {
            let timer = duration * 60;
    
            let interval = setInterval(function () {
                let hours = Math.floor(timer / 3600);
                let minutes = Math.floor((timer % 3600) / 60);
                let seconds = Math.floor(timer % 60);
    
                hours = hours < 10 ? "0" + hours : hours;
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
    
                if (hours == "00") {
                    display.textContent = minutes + ":" + seconds;
                } else {
                    display.textContent = hours + ":" + minutes + ":" + seconds;
                }
    
                if (--timer < 0) {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 1000);
        }
    
        function startPomodoroTimer(workTime, breakTime, totalDuration, display) {
            let remainingTime = totalDuration * 60;
            let isWork = true;
    
            function switchInterval() {
                if (remainingTime <= 0) {
                    // display.textContent = "Pomodoro complete!";
                    return;
                }
    
                let currentDuration = isWork ? workTime : breakTime;

                mode.textContent = isWork ? "Work Time!" : "Break Time!";
    
                startTimer(currentDuration, display, null, () => {
                    remainingTime -= currentDuration * 60;
                    isWork = !isWork; // Toggle between work and break
                    switchInterval();
                });
            }
    
            switchInterval();
        }
    
        window.onload = function () {
            let duration = x; // Set the duration in minutes
            console.log("x: " + x);
            let display = document.getElementById("timer");
            let mode = document.getElementById("mode");
            var timerStyle = document.getElementById('Tstyle').dataset.myVariable;
    
            if (timerStyle == "Grind" || timerStyle == "Chill") {
                startTimer(duration, display, 0);
            } else if (timerStyle == "Pomodoro") {
                if(duration <= 25){
                    let workTime = duration; // Work interval in minutes
                    let breakTime = 0; // Break interval in minutes
                    startPomodoroTimer(workTime, breakTime, duration, display);
                }else if(duration <= 30 && duration > 25){
                    workTime = 25;
                    breakTime = duration-25;
                    startPomodoroTimer(workTime, breakTime, duration, display);
                }else{
                    workTime = 25;
                    breakTime = 5;
                    startPomodoroTimer(workTime, breakTime, duration, display);
                }
            }

        };
    </script>
     

     <section id = "work-section">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
    </section>
</body>
</html>


